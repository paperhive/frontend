<div class="ph-component-step"
  ng-class="{
    'ph-component-step-active': $ctrl.active && !$ctrl.complete,
    'ph-component-step-inactive': !$ctrl.active,
    'ph-component-step-complete': $ctrl.complete,
    'ph-component-step-incomplete': !$ctrl.active && !$ctrl.complete,
  }"
>
  <div class="ph-component-step-number">3</div>
  <h3>Bookmark</h3>
  <form novalidate ng-submit="$ctrl.submitQuery()">
    <div class="form-group">
      <div class="input-group">
        <input ng-model="$ctrl.query" class="form-control" placeholder="Search documents"
          ng-disabled="!$ctrl.active"
        >
        <span class="input-group-btn">
          <button class="btn btn-default" type="submit"
            ng-click="$ctrl.search()"
            ng-disabled="!$ctrl.active"
          >
            <i class="fa fa-fw fa-search"></i>
          </button>
        </span>
      </div>
      <small class="help-block">
        <i class="fa fa-fw fa-info-circle"></i>
        Search
        <i ng-if="$ctrl.totalUpdating" class="fa fa-circle-o-notch fa-spin"></i>
        <span ng-if="!$ctrl.totalUpdating">{{$ctrl.total | number}}</span>
        documents by title, author, DOI or arxiv id.
      </small>
    </div>
  </form>
  <p ng-if="$ctrl.searching">
    <i class="fa fa-fw fa-circle-o-notch fa-spin"></i>
    Searching...
  </p>
  <div ng-if="!$ctrl.searching">
    <p ng-if="$ctrl.documentsTotal === 0">No documents match your query.</p>
    <p ng-if="$ctrl.documentsTotal > 0">
      Found {{$ctrl.documentsTotal | number}} documents.
    </p>
  </div>
  <div ng-repeat="document in $ctrl.documents track by document.id" class="ph-component-document">
    <div class="ph-component-document-controls">
      <button type="button" class="btn btn-link btn-sm"
        title="Bookmark"
        ng-click="$ctrl.toggleBookmark(document)"
        ng-disabled="!$ctrl.active || $ctrl.bookmarkSubmitting[document.id]"
      >
        <i class="fa fa-lg" ng-class="{
          'fa-star': document.bookmarked,
          'fa-star-o': !document.bookmarked,
        }"></i>
      </button>
    </div>
    <div class="ph-component-document-body">
      <h4 class="ph-component-title">
        <a href="./documents/{{document.id}}" target="_blank" title="{{document.title}}">
          <mathjax body="document.title"></mathjax>
        </a>
      </h4>
      <div class="ph-component-document-author-year">
        <div class="ph-component-document-author">
          <span ng-repeat="author in document.authors">
            {{author.name}}{{$last ? '' : ', '}}
          </span>
        </div>
        <div class="text-muted">&nbsp;Â·&nbsp;{{document.publishedAt | date: 'yyyy'}}</div>
      </div>
      <div class="ph-component-document-bib text-muted">
        {{$ctrl.getBib(document)}}
      </div>
    </div>
  </div>
  <button ng-if="$ctrl.documents.length < $ctrl.documentsTotal"
    ng-click="$ctrl.scroll()"
    ng-disabled="$ctrl.scrollUpdating"
    class="btn btn-default" type="button"
  >
    <i ng-if="!$ctrl.scUpdating" class="fa fa-fw fa-angle-double-down"></i>
    <i ng-if="$ctrl.scrollUpdating" class="fa fa-fw fa-circle-o-notch fa-spin"></i>
    Load more
  </button>
  <div class="ph-component-buttons text-right clearfix">
    <button type="button" class="btn btn-link pull-left ph-btn-skip"
      ng-click="$ctrl.onNext()"
      ng-disabled="!$ctrl.active"
    >Skip</button>
    <button type="button" class="btn btn-default" ng-click="$ctrl.onPrevious()">Previous</button>
    <button type="button" class="btn btn-primary" ng-click="$ctrl.next()"
    >
      <i class="fa fa-fw" ng-class="{
        'fa-circle-o-notch fa-spin': $ctrl.submitting,
        'fa-check': !$ctrl.submitting
      }"></i>
      Next
    </button>
  </div>
</div>
